# 12장\_모든 웹 개발자가 관심을 가져야 할 핵심 웹 지표

## 웹사이트와 성능

현재 네트워크, 모바일 기기의 성능과 속도는 발전되고 있지만 그와 같이 모바일 사이트는 많은 요소로 인해 비대해졌다.

전환율, 이탈율 등을 고려해서 웹사이트의 성능에 주의를 기울여야 한다.

구글의 핵심 웹 지표를 활용해보자.

## 핵심 웹 지표

사용자 경험을 제공하는데 필수적인 지표이다.

- `최대 콘텐츠풀 페인트` (`LCP` : Largest Contentful Paint)
- `최초 입력 지연` (`FID` : First Input Delay)
- `누적 레이아웃 이동` (`CLS` : Cumulative Layout Shift)
- `최초 바이트까지의 시간` (`TTFB` : Time To First Byte)
- `최초 콘텐츠풀 시간`

## 최대 콘텐츠풀 페인트(LCP)

페이지가 처음으로 로드를 시작한 시점부터 뷰포트 내부에서 **가장 큰 이미지 또는 텍스트를 렌더링하는 데 걸리는 시간이다.**

> `LCP`란 사용자의 기기가 노출하는 **뷰포트 내부에서 가장 큰 영역을 차지하는 요소가 렌더링되는 데 얼마나 걸리는지를 측정한 지표이다.**

**뷰포트 내부의 큰 이미지와 텍스트**

- `<img>`
- `<svg>` 내부의 `<image>`
- `poster` 속성을 사용하는 `<video>`
- `url()`을 통해 불러온 배경 이미지가 있는 요소
- 텍스트와 같이 인라인 텍스트 요소를 포함하고 있는 블록 레벨 요소
  - 이 블록 레벨 요소에는 `<p>`, `<div>` 등이 포함된다.

이미지와 텍스트가 각각 사용자의 시점에 언제 노출됐는지를 확인하는 정확한 시점은, **각 엘리먼트가 등장한 시점부터 텍스트 또는 이미지가 완전히 로딩되는 시점이다.**

**뷰포트 영역 밖에 넘치는 요소가 있다면 해당 영역의 크기는 고려하지 않는다.**

### 의미

`DOMContentLoaded` 이벤트는 스타일시트나 이미지 등의 로딩을 기다리지 않는다.

때문에 ‘웹페이지가 로딩이 완료되어 사용자에게 노출되기까지 걸리는 시간’이라고 보기 어렵다.

사용자 페이지 로딩을 체감하기 위해서 모든 페이지를 로딩될 필요가 없다.

→ **뷰포트를 기준으로 하는 LCP가 지표로 만들어졌다.**

### 점수

2.5는 좋음, 4초 이내는 보통, 그 이상은 나쁨으로 판단된다.

### 개선 방안

**텍스트 활용하기**

**이미지 불러오는 방법 활용하기**

1. `<img>` 브라우저의 프리로드 스캐너에 의해서 먼저 발견되어 빠르게 요청이 일어난다.
2. `<svg>`: `<svg>` 내부의 `<img>`가 로딩이 완료되기 전에는 LCP가 완료되지 않고, `<img>`와 다르게 리소스를 모두 불러온 다음에 이미지를 불러온다.
   프리로드 스캐너에 발견되지 않아 병렬 다운로드가 일어나지 않기 때문에 LCP 점수에 악영향을 준다.
3. `<video>`의 `poster`: 프리로드 스캐너에 발견되어 `<img>`와 같은 성능을 나타내는데, `poster`가 없는 경우 `video`를 로딩해 첫 번째 프레임을 삽입해주기 때문에 `video`가 LCP에 영향을 줄 것 같다면 `poster`를 반드시 넣어주는 것이 좋다.
4. `background-image: url()`: `background-image`를 비롯해서 CSS 리소스는 DOM을 그릴 준비가 될 때까지 리소스 요청을 미루기 때문에 LCP에 좋은 영향을 미치지 않는다.

### 조심해야 할 사항

**이미지 무손실 압축**

**`loading=lazy` 주의**

`loading=lazy`는 리소스를 중요하지 않음으로 표시하고 필요할 때만 로드하는 전략이다.

LCP의 이미지는 중요하지 않은 리소스로 분류하면 안 된다.

**`fadein` 같은 각종 애니메이션**

**LCP 관련 리소스는 직접 호스팅**

## 최초 입력 지연 (**FID)**

**사이트의 반응성을 측정하는 지표**가 최초 입력 지연(FID)이다.

사용자가 페이지와 처음 상호작용할 때부터 해당 상호작용에 대한 응답으로 브라우저가 실제로 이벤트 핸들러 처리를 시작하기까지 시간을 측정한다.

### 의미

자바스크립트는 싱글 스레드이므로 하나를 작업할 경우 그 외의 이벤트 리스너 같은 작업을 실행할 수 없어 지연이 발생한다.

**RAIL**

구글이 분류한 사용자 경험

- `Response`: 사용자 입력에 대한 반응 속도, 50ms 미만으로 이벤트를 처리할 것
- `Animation`: 애니메이션의 각 프레임을 10ms 이하로 생성할 것
- `Idle`: 유휴 시간을 극대화해 페이지가 50ms 이내에 사용자 입력에 응답하도록 할 것
- `Load`: 5초 이내에 콘텐츠를 전달하고 인터렉션을 준비할 것

### 점수

FID의 좋은 점수를 얻기 위해선 100ms 이내로 응답이 와야 하고, 300ms 이내는 보통, 그 이후의 경우 나쁨으로 처리된다.

### 개선 방안

**실행에 오래 걸리는 긴 작업을 분리**

**자바스크립트 코드 최소화**

**타사 자바스크립트 코드 실행의 지연**

## 누적 레이아웃 이동 (CLS)

**페이지의 생명주기 동안 발생하는 모든 예기치 않은 이동에 대한 지표를 계산하는 것**이 누적 레이아웃 이동(CLS)이다.

### 의미

CLS는 뷰포트 내부 요소에 대해서만 측정하고, 최초 렌더링이 시작된 위치에서 만약 레이아웃의 이동이 발생한다면 CLS 점수로 기록되게 된다.

### 개선 방안

**삽입이 예상되는 요소를 위한 추가적 공간 확보**

**폰트 로딩 최적화**

**적절한 이미지 크기 설정**

## 핵심은 아니지만 성능 확인에 중요한 지표

### 최초 바이트까지의 시간 (TTFB)

브라우저가 웹페이지의 첫 번째 바이트를 수신하는데 걸리는 시간을 의미한다.

SSR에서 주의 깊게 봐야 하는 지표이다.

SSR은 최초 페이지를 만들기 위해 서버에서 어느 정도 작업을 수행해야 하기 때문이다.

로직을 최적화하거나, 웹페이지의 주된 방문객의 국적을 파악해 해당 국적과 가깝게 서버를 위치시키는 것이 좋다.

### 최초 콘텐츠풀 페인트 (FCP)

웹페이지에 접속한 순간부터 페이지에서 무언가가 나타나기 시작한 시점까지의 시간이다.

텍스트, 이미지, svg 등이 나타나기 시작한 시점이다.

1.8초이면 좋음, 3.0초면 보통, 그 이후는 개선이 필요하다.

# 13장\_웹페이지의 성능을 측정하는 다양한 방법

## 애플리케이션에서 확인하기

### create-react-app

`reportWebVitals` : 웹에서 성능을 측정하기 위한 함수이다.

`ReportHandler` : 성능 객체인 Metric을 인수로 받는 함수 타입이다.

### create-next-app

`NextxWebVitalsMetric`

## 구글 라이트하우스

구글 핵심 웹 지표, 접근성, PWA, SEO 등 다양한 요소를 측정하고 점검할 수 있다.

### 성능

FCP, LCP, CLS 등이 있다.

추가로 3개의 지표가 존재한다.

1. `Time to Interactive` : 페이지에서 사용자가 완전이 인터랙션 할 수 있을 때까지 걸리는 시간을 측정한다.
2. `Speed Index` : 페이지가 로드되는 동안 얼마나 빨리 시각적으로 표시되는지를 계산한다.
3. `Total Blocking Time` : 메인 스레드에서 특정 시간 이상 실행되는 작업, 긴 작업이 수행될 때마다 메인 스레드가 차단된 것으로 간주한다.
   이렇게 실행되는 긴 작업을 모아서 총 차단 시간이라고 한다.

### 접근성

### 권장사항

보안, 표준 모드, 최신 라이브러리, 소스 맵 등이 포함되어 있다.

### 검색 엔진 최적화

구글이 쉽게 웹페이지 정보를 가져가서 공개할 수 있도록 최적화돼 있는지를 확인한다.

rovots.txt가 유효한지, <meta> 등을 제대로 작성했는지 등을 확인한다.

### 구글 라이트하우스 - 기간 모드

실제 웹페이지를 탐색하는 동안 지표를 측정한다.

### 구글 라이트하우스 - 스냅샷

현재 페이지 상태를 기준으로 분석한다.

## WebpageTest

웹사이트 성능을 분석하는 도구이다.

1. Site Perfomance
   - 웹사이트 성능 분석을 위한 도구
2. Core Web Vitals
   - 웹사이트의 핵심 웹 지표를 확인하기 위한 도구
3. Lighthouse
   - 구글 라이트하우스 도구
4. Visual Comparison
   - 2개 이상의 사이트를 동시에 실행해 시간의 흐름에 따른 로딩과정을 비교하는 도구
5. Traceroute
   - 네트워크 경로를 확인하는 도구

## 크롬 개발자 도구
