# [11회차 08.11.] 12, 13장

# 12장 모든 웹 개발자가 관심을 가져야 할 핵심 웹 지표

## 12.1 웹사이트와 성능

사용자가 웹사이트에 접속했을 때 공통적으로 기대하는 사항은 다음과 같다

1. 웹 사이트를 방문한 목적을 손쉽게 달성할 수 있어야 한다
2. 첫 번째 목적을 달성하는 데 걸리는 시간이 짧아야 한다
3. 웹사이트에서 개인정보가 누출되는 등의 사고 없이 보안이 철저해야 한다

## 12.2 핵심 웹 지표란?

구글에서 만든 지표로, 웹사이트에서 뛰어난 사용자 경험을 제공하는 데 필수적인 지표를 일컫는 용어다.
구글에서 핵심 웹 지표로 꼽는 지표는 다음과 같다.

- 최대 콘텐츠풀 페인트(LCP)
- 최초 입력 지연(FID)
- 누적 레이아웃 이동(CLS)

그리고 다음 두 지표는 핵심까지는 아니지만, 특정 문제를 진단하는 데 사용될 수 있다.

- 최초 바이트까지의 시간(TTFB)
- 최초 콘텐츠풀 시간(FCP)

## 12.3 최대 콘텐츠풀 페인트(LCP)

### 12.3.1 정의

페이지가 처음으로 로드를 시작한 시점부터 뷰포트 내부에서 가장 큰 이미지 또는 텍스트를 렌더링하는 데 걸린 시간을 말한다

뷰포트 내부에서 '큰 이미지'와 텍스트'는 다음과 같이 정의돼 있다.

- `<img>`
- `<svg>` 내부의 `<image>`
- poster 속성을 사용하는 `<video>`
- url()을 통해 불러온 배경 이미지가 있는 요소
- 텍스트와 같이 인라인 텍스트 요소를 포함하고 있는 블록 레벨 요소
    - 이 블록 레벨 요소에는 `<p>`, `<div>` 등이 포함된다.

최대 콘텐츠풀 페인트(LCP)란 사용자의 기기가 노출하는 뷰포트 내부에서 가장 큰 영역을 차지하는 요소로 렌더링되는 데 얼마나 걸리는지를 측정하는 지표인 것이다.

### 12.3.2 의미

사용자에게 페이지의 정보를 화면에 전달하는 속도를 객관적으로 판단하기 위한 지표로 만들어진 것이 바로 최대 콘텐츠풀 페인트(LCP)다.

### 12.3.3 예제

### 12.3.4 기준 점수

- 2.5초 이하 좋음, 4초 이내 보통, 그 이상 나쁨

### 12.3.5 개선 방안

- **텍스트는 언제나 옳다**
    
    LCP지표에서 좋은 점수를 얻는 가장 확실한 방법은 뷰포트 최대 영역에 이미지가 아닌 문자열을 넣는 것이다.
    
    아무리 이미지를 최적화하더라도 추가적인 리소스 다운로드가 필요한 이미지보다 텍스트 노출이 훨씬 더 빠르다.
    

## 12.4 최초 입력 지연(FID)

### 12.4.1 정의

웹페이지의 로딩 속도만큼 중요한 것이 웹사이트의 반응 속도다. 이러한 웹사이트의 반응성을 측정하는 지표가 바로 최초 입력 지연 (FID: First Input Delay)이다.

**최초 입력 지연 (FID: First Input Delay)란**

> 사용자가 페이지와 처음 상요 작용할 때부터 해당 상호 작용에 대한 응답으로 브라우저가 실제로 이벤트 핸들러 처리를 시작하기까지의 시간을 측정한다.
> 

### 12.4.2 의미

이벤트가 발생하는 시점에 최대한 메인 스레드가 다른 작업을 처리할 수 있도록 여유을 만들어 둬야 사용자에게 빠른 반응성을 보장할 수 있다.

### 12.4.3 예제

### 12.4.4 기준 점수

- 100ms 이내 좋음, 300ms 이내 보통, 그 이하 나쁨

### 12.4.5 개선 방안

- **실행에 오래 걸리는 긴 작업을 분리**
- **자바스크립트 코드 최소화**
- **타사 자바스크립트 코드 실행의 지연**

## 12.5 누적 레이아웃 이동(CLS)

### 12.5.1 정의

페이지의 생명주기 동안 발생하는 모든 예기치 않은 이동에 대한 지표를 계산하는 것이 바로 누적 레이아웃 이동(CLS)이다.

### 12.5.2 의미

리액트로 만들어진 웹사이트는 `useEffect`를 사용하며, useEffect는 렌더링이 한 번 끝난 이후에 콜백 함수는 실행하는 훅이다.
useEffect가 많을수록 클라이언트에서 처리해야 하는 작업이 많아진다.

### 12.5.3 예제

### 12.5.4 기준 점수

- 0.1이하 좋음, 0.25이하 보통, 0.25초과 나쁨

### 12.5.5 개선 방안

- **삽입이 예상되는 요소를 위한 추가적인 공간 확보**
- **폰트 로딩 최적화**
- **적절한 이미지 크기 설정**

### 12.5.6 핵심 웹 지표는 아니지만 성능 확인에 중요한 지표들

- **최초 바이트까지의 시간 (TTFB: Time To First Byte)**
    
    브라우저가 웹페이지의 첫 번째 바이트를 수신하는데 걸리는 시간
    
    즉, 페이지를 요청했을 때 요청이 완전히 완료되는 데 걸리는 시간이 아닌 최초의 응답이 오는 바이트까지가 얼마나 걸리는지를 측정하는 지표다.
    
    특히 서버 사이드 렌더링을 하고 있는 경우 주의 깊게 봐야한다. 서버에서 첫 번째 HTML을 만들기 위해 해야 하는 작업이 많거나 느릴 수록 TTFB의 시간이 길어진다.
    
    renderToNodeStream이나 renderToStaticNodeStream과 같은 스트리밍 API를 사용해서 TTFB를 개선할 수 있다
    
- **최초 콘텐츠풀 페인트(FCP: First Contentful Paint)**
    
    페이지가 로드되기 시작한 시점부터 페이지 콘텐츠의 일부가 화면에 렌더링될 때까지의 시간을 측정한다. 웹사이트에 접속한 순간부터 페이지에 텍스트, 이미지, svg 등.. 이 뜨기 시작한 시간을 의미한다.
    
    - 1.8초 이내 좋음, 3.0초 이내 보통, 3.0초 초과 나쁨

# 13장 웹페이지의 성능을 측정하는 다양한 방법

## 13.1 애플리케이션에서 확인하기

### 13.1.1 create-react-app

reportWebVitals 함수는 웹에서 성능을 측정하기 위한 함수다. CLS, FID, FCP, LCP, TTFB를 측정하는 용도로 사용된다.

### 13.1.2 create-next-app

기본적으로 Next.js는 성능 측정을 할 수 있는 메서드인 NextWebVitalsMetric을 제공한다. _app.tsx 파일에 다음과 같이 코드를 추가해서 사용해보자.

- Next.js-hydration: 페이지가 서버 사이드에서 렌더링되어 하이드레이션하는 데 걸린 시간
- Next.js-route-change-to-render: 페이지가 경로를 변경한 후 페이지를 렌더링을 시작하는 데 걸리는 시간
- Next.js-render: 경로 변경이 완료된 후 페이지를 렌더링하는 데 걸린 시간

값의 시간 단위는 밀리초(ms)이다.

## 13.2 구글 라이트하우스

구글 라이트하우스로 코드 수정이나 배포, 수집 없이도 지표를 수집할 수 있다.
웹 페이지 성능 측정 도구로, 오픈소스로 운영되며 PWA, SEO등 웹 페이지를 둘러싼 다양한 요소들을 측정하고 점검할 수 있다.

### 13.2.1 구글 라이트하우스-탐색 모드

**성능**

핵심 웹 지표인 FCL, LCP, CLS, TTI, Soeed Index, Total Blocking Time 의 값을 확인할 수 있다.

**접근성**

장애인 및 고령자 등 신체적으로 불편한 사람들이 일반적인 사용자와 동등하게 웹페이지를 이용할 수 있도록 보장하는 것이다.

**권장사항**

웹 사이트를 개발할 때 고려해야 할 요소들을 얼마나 지키고 있는지 확인할 수 있다.

**검색 엔진 최적화**

### 13.2.2 구글 라이트하우스-기간 모드

기간모드는 실제 웹페이지를 탐색하는 동안 지표를 측정하는 것이다.

**흔적**

**트리맵**

### 13.2.3 구글 라이트하우스-스냅샷

탐색 모드와 매우 유사하지만 현재 페이지 상태를 기준으로 분석한다.

## 13.3 WebPageTest

웹사이트 성능을 분석하는 도구다.

### 13.3.1 Performance Summary

테스트가 완료되면 전체적인 결과를 요약해서 볼 수 있다.

성능 테스트는 총 3번 이뤄지기 떄문에 3개의 서로 다른 결과를 확인할 수 있다.

### 13.3.2 Opportunities & Experiments

### 13.3.3 Filmstrip

렌더링을 가로막는 리소스나 예상보다 일찍 실행되는 스크립트 등을 확인할 수 있다

### 13.3.4 Details

Filmstrip에서 보여준 내용을 자세하게 보여주는 영역이다

### 13.3.5 Web Vitals

LCP, CLS, TBT에 대한 자세한 내용을 확인할 수 있다.

### 13.3.6 Optimizations

리소스들이 얼마나 최적화돼 있는지를 나타낸다.

### 13.3.7 Content

웹사이트에서 제공하는 콘텐츠, 애셋을 종류별로 묶어 통계를 보여준다. 에셋 종류별 크기와 로딩 과정을 확인할 수 있으며, 시간의 흐름에 따라 렌더링을 거치면서 어떻게 에셋을 불러오는지도 확인할 수 있다.

### 13.3.8 Domains

Content메뉴에서 보여준 에셋들이 어느 도메인에서 왔는지를 도메인별로 묶어서 확인할 수 있다.

### 13.3.9 Console Log

웹 페이지에 접속했을 때 `console.log`로 무엇이 기록됐는지를 확인할 수 있다.

### 13.3.10 Detected Technologies

웹 사이트를 개발하는 데 사용된 기술을 확인할 수 있다.

### 13.3.11 Main-thread Processing

### 13.3.12 Lighthouse Report

구글 라이트하우스 리포트를 확인할 수 있다.

### 13.3.13 기타

## 13.4 크롬 개발자 도구

크롬 개발자 도구를 활용하기 위해서는 크롬 확장 프로그램으로 인해 이슈를 파악하는 데 방해가 될 수 있으니 시크릿 창으로 웹사이트를 여는 것이 좋다.

### 13.4.1 성능 통계

개발자 도구 Performance Insight는 웹사이트의 성능을 자세하게 확인할 수 있다.
Page Load를 선택해 웹사이트 로딩 시작부터 끝까지를 확인하거나, Start Recording을 눌러서 원하는 액션을 수행하면서 웹사이트 성능을 측정할 수 있다.

**Insights**
성능을 측정하는 기간 동안 발생한 이벤트 중 눈여겨봐야 할 내용을 시간의 흐름에 따라 모아서 보여준다.

### 13.4.2 성능

## 13.5 정리
