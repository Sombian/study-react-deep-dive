# 12장

## 웹사이트와 성능

Protent, Google 등 여러 웹사이트의 성능이 미치는 영향에 대해서 연구 결과를 내놓은 바 있다. 다양한 지표들 가운데 핵심적인 결론은, 페이지 로드 시간은 사용자의 이탈과 직결된다는 것이다. 로드 시간을 획기적으로 줄일 수 있는 다양한 기술들의 발전과 더불어 인터넷 자체의 속도가 비약적으로 개선되었음에도 불구하고, 사용자 입장에서는 예나 지금이나 크게 차이를 느끼기 힘들다. 이러한 현상에는 여러 요인이 작용하지만, 대표적인 이유는 과거에 비해 현대 웹사이트는 훨씬 많은 정보를 제공하기 때문이다.

## 핵심 웹 지표

핵심 웹 지표(Core Web Vital)은 구글사에서 만든 지표이다. 과거에도 웹사이트의 성능을 측정하기 위한 다양한 도구와 지표가 있었지만, 뚜렷한 표준이나 측정 방법이 정해져 있지 않아 일관되게 판단하기 어려웠다.

(핵심 웹 지표)
- 최대 콘텐츠풀 페인트(Largest Contentful Paint)
- 최초 입력 지연(First Input Delay)
- 누적 레이아웃 이동(Comulative Layout Shift)

(특정 문제를 진단 가능한 지표)
- 최초 바이트까지의 시간(Time To First Byte)
- 최초 콘텐트풀 시간(First Contentful Paint)

### 최대 콘텐츠풀 페인트

페이지가 처음으로 로드를 시작한 시점으로부터 뷰포트 내부에서 가장 큰 이미지 또는 텍스트를 렌더링하는 데 걸리는 시간을 뜻한다. 즉, 전체 페이지의 로드 여부와는 별개로, 사용자 경험을 위해 최초 화면에 노출되는 요소가 전달되는 속도를 기준으로 하는 지표이다.

해당 지표의 점수를 높일 수 있는 가장 확실한 방법은 최대 콘텐츠풀 페인트 예상 영역에 이미지가 아닌 문자열을 삽입하는 것이다. 또한 이미지를 불러오는 속도는 background-image = <svg> < <img> < <video> 순으로 속도가 빠르다. 또한 loading=lazy 는 지표 점수에 도움이 되지 않는다.

### 최초 입력 지연

최초 콘텐츠풀 페인트가 사용자에게 웹사이트의 중요한 콘텐츠를 얼마나 빠르게 노출하는지 측정하는 지표였다면, 최초 입력 지연은 문자 그대로 최초 입력에 한해 사용자가 얼마나 빠르게 웹페이지와의 상호작용에 대한 응답을 받을 수 있는지 측정하는 지표이다.

구글은 사용자 경험을 크게 4가지로 분리하는데, 이를 RAIL이라고 부른다. 이 RAIL에 해당하는 것들은 다음과 같다.

- Response: 사용자 입력에 대한 반응 속도로, 50ms 미만으로 처리할 것
- Animation: 애니메이션의 각 프레임을 10ms 이하로 생성할 것것
- Idle: 유휴 시간을 극대화해 페이지가 50ms 이내에 사용자 입력에 응답할 것
- Load: 5초 이내에 콘텐츠를 전달하고 반응성을 추가할 것

최초 입력 지연은 R에 해당하는 지표이다. 이를 개선하기 위해서는 많은 시간이 소요되는 작업을 분리하고, 또한 불필요한 코드(e.g. polyfill)를 최소화 또는 필요할 경우에만 불러오는 등의 방법을 사용할 수 있다.

### 누적 레이아웃 이동

페이지의 생명주기 동안 발생하는 모든 예기치 않은 이동에 대한 지표로서, 해당 지표는 낮을수록 좋다.

이를 개선하기 위해서는 요소가 배치될 위치에 미리 스켈레톤을 활용해 공간을 점유하거나 서버 사이드 렌더링 등의 방법을 사용할 수 있다.

### 최초 바이트까지의 시간

브라우저가 웹페이지의 첫 번째 바이트를 수신하는데 걸리는 시간을 의미한다. 즉, 페이지를 요청했을 때 요청이 완전히 완료되는 데 걸리는 시간을 측정하는 것이 아니라 최초의 응답이 오는 바이트가 얼마나 걸리는지를 측정하는 지표이다.

### 최소 콘텐츠풀 페인트

페이지가 로드되기 시작한 시점부터 페이지 콘텐츠의 일부가 화면에 렌더링될 때까지의 시간을 의미한다.

# 13장

## 웹사이트의 성능 측정

### create-react-app

web-vitals은 PerformanceObserver API를 사용한 라이브러리로, 브라우저에서 웹페이지의 성능을 측정할 수 있다. 즉, 해당 API를 미지원하는 경우에는 성능을 측정할 수 없다.

### create-next-app

Next.js는 성능 측정을 할 수 있는 NextWebVitalMetric을 지원한다. 이때 핵심 웹 지표 외에도 Next.js에 특화된 사용자 지표 또한 출력된다.

### Google Lighthouse

구글사에서 제공하는 웹 페이지 성능 측정 도구로, 에플리케이션 코드 수정 없이 브라우저에서 바로 개발자 도구처럼 사용 가능하다. 설치된 다른 확정 프로그램 등이 영향을 줄 수 있기에 가급적 시크릿 창으로 실행하는 것이 권장된다.

### WebPageTest

심도 있는 유료 기능들을 포함한 가장 널리 알려진 웹사이트 성능 분석 도구이다. 결제를 하지 않아도 제공되는 무료 기능들이 매우 다양하다.

### 개발자 도구

개발자 도구를 통해 성능 저하의 정확한 원인을 파악할 수 있다.
