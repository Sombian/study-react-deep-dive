# 1장 리액트 개발을 위해 꼭 알아야 할 자바스크립트

### 1.1 자바스크립트의 동등 비교
##### 1.1.4 리액트에서의 동등 비교
리액트에서 사용하는 동등비교는 ==이나 ===이 아닌 Object.js이다. Object.is를 바탕으로 리액트에서는 이를 구현한 폴리필(Polyfill)을 함께 사용한다. 요약하자면 Object.is 로 먼저 비교를 수행 한 뒤, Object.is에서 수행하지 못하는 비교, 즉 객체 간 얕은 비교를 한 번 더 수행한다.

### 1.2 함수
##### 1.2.2 함수를 정의하는 4가지 방법
함수 표현식에서는 할당하려는 함수의 이름을 생략하는 것이 일반적이다. 그 이유는 코드를 봤을 때 혼란을 방지하기 위함이다.

**함수 표현식과 선언식의 차이**

두 가지 방식의 가장 큰 차이는 호이스팅 여부다. 

함수 호이스팅은 함수에 대한 선언을 실행 전에 미리 메모리에 등록하는 작업을 의미한다. 이러한 함수의 호이스팅이라는 특징 덕분에 함수 선언문이 미리 메모리에 등록됐고, 코드의 순서에 상관없이 정상적으로 함수를 호출할 수 있게 된다.

반면 함수 표현식은 함수를 변수에 할당했다. 변수도 마찬가지로 호이스팅이 발생한다. 그러나 함수의 호이스팅과는 다르게, 호이스팅되는 시점에서 var의 경우에는 undefined로 초기화한다는 차이가 있다.

##### 1.2.3 다양한 함수 살펴보기
**즉시 실행 함수**

즉시 실행 함수는 한 번 선언하고 호출된 이후부터는 더 이상 재호출이 불가능하다. 그래서 일반적으로는 **즉시 실행 함수에 이름을 붙이지 않는다.**

**고차 함수**

##### 1.2.4 함수를 만들 때 주의해야 할 사항
**함수의 부수 효과를 최대한 억제해라**

함수의 부수 효과란 함수 내의 작동으로 인해 함수가 아닌 함수 외부에 영향을 끼치는 것을 의미한다. 이러한 부수 효과가 없는 함수를 순수 함수라 하고, 부수 효과가 존재하는 함수를 비순수 함수라고 한다.

즉 순수 함수는 부수 효과가 없고, 언제 어디서나 어떠한 상황에서든 동일한 인수를 받으면 동일한 결과를 반환해야 한다. 

리액트의 관점에서 본다면 부수 효과를 처리하는 훅인 useEffect의 작동을 최소화하는 것이다.

**가능한 한 함수를 작게 만들어라**

**누구나 이해할 수 있는 이름을 붙여라**

### 1.3 클래스 
자바스크립트의 클래스란 특정한 객체를 만들기 위한 일종의 템플릿과 같은 개념이다. 특정한 형태의 객체를 반복적으로 만들기 위해 사용된다. 

### 1.4 클로저

클로저는 함수와 함수가 선언된 어휘적 환경(Lexical Scope)의 조합이다. -MDN

여기서 선언적 어휘적 환경 이라는 것은 변수가 코드 내부에서 어디서 선언됐는지를 말하는 것이다. 이는 호출되는 방식에 따라 동적으로 결정되는 this와는 다르게 코드가 작성한 순간에 정적으로 결정된다.

##### 1.4.2 변수의 유효 범위, 스코프

**전역 스코프**

**함수 스코프**

다른 언어와 달리 자바스크립트는 기본적으로 함수 레벨 스코프를 따른다. 즉, {} 블록이 스코프 범위를 결정하지 않는다.

**리액트에서의 클로저**

클로저 원리를 사용하고 있는 대표적인 것 중 하나가 바로 useState다.
```
<script>
function Component() {
 const [state,setState] = useState()
 
 function handleClick(){
 	//useState 호출은 위에서 끝났지만,
    // setState는 계속 내부의 최신값(prev)을 알고있다.
    //이는 클로저를 활용했기 때문에 가능하다.
    setState((prev) => prev +1)
 }
 
}
</script>
```

useState 함수의 호출은 Component 내부 첫 줄에서 종료됐는데, setState는 useState 내부의 최신 값을 어떻게 계속해서 확인할 수 있을까?

바로 클로저가 useState 내부에서 활용됐기 때문이다.

외부 함수(useState)가 반환한 내부 함수(setState)는 외부 함수(useState)의 호출이 끝났음에도 자신이 선언된 외부 함수가 선언된 환경(state가 저장돼 있는 어딘가)을 기억하기 때문에 계속해서 state 값을 사용할 수 있는 것이다.

**클로저 사용 할 때 주의할 점**

클로저는 사용하는 데는 비용이 든다. 클로저는 생성될때마다 그 선언적 환경을 기억해야 하므로 추가 비용이 발생한다.

클로저가 선언된 순간 내부 함수는 외부 함수의 선언적인 환경을 기억하고 있어야 하므로 이를 어디에서 사용하는지 여부에 관계없이 저장해 둔다.

클로저의 개념,즉 외부 함수를 기억하고 이를 내부 함수에서 가져다 쓰는 메커니즘은 성능에 영향을 미친다.클로저에 꼭 필요한 작업만 남겨두지 않는다면 메모리를 불필요하게 잡아먹는 결과가 생긴다.클로저를 적절한 스코프로 가둬두지 않는다면 성능에 악영향을 미친다.

### 1.5 이벤트 루프와 비동기 통신의 이해

- 자바스크립트는 싱글 스레드에서 작동하기 때문에 한 번에 하나의 작업만 동기 방식으로 처리할 수 있는 것이 기본이다.
- 그렇지만 이벤트 루프 등의 개념을 활용해 비동기 요청을 처리할 수 있다.

##### 1.5.1 싱글 스레드 자바스크립트

- 프로세스: 프로그램을 구동해 프로그램의 상태가 메모리상에서 실행되는 작업 단위, 즉 하나의 프로그램 실행은 하나의 프로세스를 가지고 그 프로세스 내부에서 모든 작업이 처리되는 것

동시에 여러 개의 복잡한 작업을 수행하기 위해서 스레드라는 더 작은 실행 단위가 등장

- 스레드: 하나의 프로세스에서 여러 개의 스레드를 만들 수 있고 스레드 끼리는 메모리를 공유할 수 있어 여러 가지 작업을 동시에 수행할 수 있다.

결국 프로세스 내부에서 여러 개의 스레드를 활용하면서 동시 다발적인 작업 처리가 가능해짐.

- 싱글 스레드 자바스크립트라는 것은 자바스크립트 코드의 실행이 하나의 스레드에서 순차적으로 이루어진다는 의미

##### 1.5.2 이벤트 루프란?

이벤트 루프란 자바스크립트 런타임 외부에서 자바스크립트 비동기 실행을 돕기 위해 만들어진 장치
- 호출 스택과 이벤트 루프
  - 호출 스택은 자바스크립트에서 수행해야 할 코드나 함수를 순차적으로 담아두는 스택
- 호출 스택에 실행 중인 코드가 있는지, 그리고 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인하는 역할
- 호출 스택이 비었다면 태스크 큐에 대기 중인 작업이 있는지 확인하고 이 작업을 실행 가능한 오래된 것부터 순차적으로 꺼내와서 실행한다.

##### 1.5.3 태스크 큐와 마이크로 태스크 큐

- 마이크로 태스크
  - Promise
- 마이크로 태스크 큐는 기존 태스크 큐보다 우선권을 갖는다. 즉, `setTimeout` 과 `setInterval` 은 Promise 보다 늦게 실행
- 마이크로 태스크 큐 작업이 끝날 때 마다 렌더링이 실행된다.

### 1.6 리액트에서 자주 사용하는 자바스크립트 문법

##### 1.6.1 구조 분해 할당

- 배열 또는 객체의 값을 분해해 개별 변수에 즉시 할당
- 배열은 이름을 변경할 수 있고, 객체는 객체 내부 이름으로 사용 가능
- `useState` 는 배열 구조 분해 할당을 활용한 예시

##### 1.6.2 전개 구문

- spread syntax
- 객체, 문자열과 같이 순회할 수 있는 값에 대해 전개해서 간결하게 사용할 수 있는 구문
- 배열과 객체의 전개 구문을 활용하면 `push()` , `concat()` , `splice()` 등의 메서드를 사용하지 않고도 합성이 가능하다.
- 단, 객체 전개 구문에 있어서는 순서가 중요하다.

### 1.6.3 객체 초기자

- 객체를 선언할 때 객체에 넣고자 하는 키와 값을 가지고 있는 변수가 이미 존재한다면 해당 값을 간결하게 넣어줄 수 있는 방식

##### 1.6.4 Array 프로토타입의 메서드: map, filter, reduce, forEach

- map: 인수로 전달받은 배열과 똑같은 길이의 새로운 배열을 반환하는 메서드
- filter: 콜백 함수를 인수로 받고, 콜백 함수에서 truthy 조건을 만족하는 경우에만 해당 원소를 반환
- reduce: 콜백 함수와 함께 초깃값을 추가로 인수를 받는데 이 초깃값에 따라 배열이나 객체, 또는 그 외의 다른 무언가를 반환할 수 있는 메서드
- forEach: 콜백 함수를 받아 배열을 순회하면서 단순히 그 콜백 함수를 실행하기만 하는 메서드

##### 1.6.5 삼항 조건 연산자

- 자바스크립트에서 유일하게 3개의 피연산자를 취할 수 있는 문법

```html
조건문 ? 참일 때 값 : 거짓일 때 값
```

- 삼항 조건 연산자는 가급적이면 가독성을 위해서 중첩하지 않는 편이 좋다.

### 1.7 선택이 아닌 필수, 타입스크립트

##### 1.7.1 타입스크립트란?

- TypeScript is JavaScript with syntax for types
- 자바스크립트는 기본적으로 동적 타입의 언어이기 때문에 대부분의 에러를 코드를 실행했을 때만 확인할 수 있다는 문제점이 있다.
- 자바스크립트의 한계를 벗어나 타입 체크를 정적으로 런타임이 아닌 빌드 타임에 수행할 수 있게 해 준다.

##### 1.7.2 리액트 코드를 효과적으로 작성하기 위한 타입스크립트 활용법

- any 대신 unknown을 사용하자
- 
any는 타입스크립트를 사용하는 의미가 없어지게 만들기 때문에 정말 예외적인 경우에만 사용하는 것이 좋다.

대신 아직 타입을 단정할 수 없는 경우에는 unknown 을 사용하는 것이 좋다.

```
function doSomething(callback: unknown) { if (typeof callback ===
'function') { callback() } throw new Error('callback은 함수여야 합니다.') }
```
이렇게 typeof를 사용해서 unknown에 직접 접근하는 대신 해당 unknown 값이 우리가 원하는 타입일 때만 의도대로 작동하도록 코드를 작성
  - unknown: top type VS never: bottom type
  - never은 어떤 타입도 들어올 수 없음을 의미, 코드상으로 존재가 불가능한 타입
- 타입 가드를 적극 활용하자
  - 타입을 사용할 때는 타입을 좁히는 것이 좋다. 타입을 좁히는데 도움을 주는 것이 타입 가드
  - instanceof: 클래스로 타입을 만들어서 타입 체크를 할 때 해당 클래스의 인스턴스인지 체크
  - typeof: 특정 요소에 대한 자료형을 확인
  - in: 어떤 객체에 키가 존재하는지 확인하는 용도
- 제네릭: 함수나 클래스 내부에서 단일 타입이 아닌 다양한 타입에 대응할 수 있도록 도와주는 도구
```
const [state, setState] = useState<string>('')</string>
```
- 인덱스 시그니처: 객체의 키를 정의하는 방식, 키에 원하는 타입을 부여할 수 있다.
```
type Hello = { [key: string]: string }
```
  여기서 `[key: string]` 이 부분이 인덱스 시그니처
  - 인덱스 시그니처를 사용할 경우 key의 범위가 string, number 등 커지기 때문에 키의 타입을 좁히는 방법이 필요하다. `Record<Key, Value>` 혹은 `type` 을 활용해 타입을 좁힐 수 있다.

  - `Object.keys` 를 활용해서 객체의 키들을 뽑아낼 경우 타입 에러가 발생할 수 있다. 이럴 때는 `as` 를 활용해 타입 단언을 해 줄 수 있다.

### 1.7.3 타입스크립트 전환 가이드

- tsconfig.json 먼저 작성하기
  - 주요 옵션 목록
    - `outDir` : .ts 나 .js 가 만들어진 결과를 넣어두는 폴더
    - `allowJs` : .js 파일을 허용할 것인지
    - `target` : 결과물이 될 자바스크립트 버전 지정
    - `include` : 트랜스파일 할 자바스크립트와 타입스크립트 파일 지정
- JSDoc과 @ts-check를 활용해 점진적으로 전환하기
  - 자바스크립트 파일 최상단에 //@ts-check를 선언하고 JSDoc을 활용해 변수나 함수에 타입을 제공하면 타입 체크 가능
- 타입 기반 라이브러리 사용을 위해 @types 모듈 설치하기
  - 자바스크립트 기반으로 작성된 라이브러리를 타입스크립트에서 사용하기 위해서는 @types 모듈을 설치
  - ex. `@types/react`
- 파일 단위로 조금씩 전환하기
