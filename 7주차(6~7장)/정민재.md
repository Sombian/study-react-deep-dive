# [7회차 07.21.] 6, 7장

# 6장 리액트 개발 도구로 디버깅하기

## 6.1 리액트 개발 도구란?

- 리액트 팀은 애플리케이션을 디버깅할 수 있는 react-dev-tools개발 도구를 제공한다.
- 웹 개발 환경에서 가장 편리하게 사용할 수 있는 방법 중 하나인, 리액트 개발 도구를 브라우저 확장 도구로 설치해 리액트 애플리케이션을 디버깅하는 방법.

## 6.2 리액트 개발 도구 설치

## 6.3 리액트 개발 도구 활용하기

- Components탭과 Profiler탭은 리액트 개발자 도구에서 제공하는 디버그 도구다.

### 6.3.1 컴포넌트

- 현재 리액트 애플리케이션의 컴포넌트 트리를 확인할 수 있다.
- props와 내부 hooks 등 다양한 정보를 확인할 수 있다.
- **컴포넌트 트리**
    - Components의 왼쪽 영역은 해당 리액트 페이지의 컴포넌트 트리를 나타낸다.
    - 기명 함수로 선언된 컴포넌트는 해당 컴포넌트 명을 보여주고,
    익명 함수로 선언돼 있다면 Anonymous라는 이름으로 컴포넌트를 보여준다.
    - 기명 함수로 선언하는 것은 디버깅하는 데 많은 도움이 된다.
    - 기명 함수로 변경하기 어렵다면 **displayName** 속성을 추가하는 방법도 있다.
        
        ```jsx
        const MemoizedComponent = memo(function () {
          return <>MemoizedComponent</>;
        });
        MemoizedComponent.displayName = '메모 컴포넌트입니다.';
        ```
        
    - **고차 컴포넌트**는 일반적으로 고차 컴포넌트와 일반 컴포넌트의 조합으로 구성되므로 **displayName** 을 잘 설정하면 디버깅하는데 많은 도움이 된다.
- **컴포넌트명과 props**
    - 컴포넌트 트리에서 선택했을 때 해당 컴포넌트에 대한 자세한 정보를 보여주는 영역이다.
- **컴포넌트명과 key**
    - 컴포넌트의 명칭과 해당 컴포넌트를 나타낸다.
    - **컴포넌트 명칭**은 **Anonymous(익명함수)**이며, **key**는 **kidsValueProp**라고 하는 객체다.
    - 왼쪽 상단에 빨간색 경고 이모티콘이 뜬다면 해당 애플리케이션이 strict mode로 렌더링되지 않았다는 것을 의미.
- **컴포넌트 도구**
    - 눈 아이콘 클릭 시, 요소(Element) 탭으로 이동하며, 해당 컴포넌트가 렌더링한 HTML 요소가 선택되는 것을 볼 수 있다.
    - 벌레 아이콘 클릭 시, 콘솔(console) 탭에 해당 컴포넌트의 정보가 console.log를 실행해 기록된 것을 확인할 수 있다.
    - 소스 아이콘 클릭 시, 해당 컴포넌트의 소스코드를 확인할 수 있다. 왼쪽 하단 { } 버튼을 클릭하면 난독화돼 있던 코드가 적절한 여백과 줄바꿈을 거쳐 읽기 쉬운 상태로 변경된다.
- **컴포넌트 props**
    - 원시값 뿐만아니라 함수도 포함된 해당 컴포넌트가 받은 props를 확인할 수 있다.
    - 우 클릭 시, props 정보를 클립보드에 복사하는 Copy value to clipboard와 window.$r에 복사되는 Store as global variable 버튼이 나온다.
- **컴포넌트 hooks**
    - 훅에 넘겨주는 함수를 익명 함수 대신 기명 함수로 넘겨주면 해당 훅을 실행할 때 실행할 때 실행되는 함수의 이름을 확인할 수 있다.
- **컴포넌트를 렌더링한 주체 rendered by**
    - 해당 컴포넌트를 렌더링한 주체가 누구인지 확인할 수 있다.
    - 개발 보드에서는 해당 컴포넌트를 렌더링한 부모 컴포넌트까지 확인할 수 있다.

### 6.3.2 프로파일러

- 리액트가 렌더링하는 과정에서 발생하는 상황을 확인하기 위한 도구다.
- 렌더링되는 과정에서 어떤 컴포넌트가 몇 차례나 렌더링이 일어났으며, 어떤 작업에서 오래 걸렸는지 등을 확인할 수 있다.
- **설정 변경하기**
    - `General 탭의 Highlight updates when components render` : 렌더링이 일어날 때마다 해당 컴포넌트에 하이라이트 표시.
    - `Debugging 탭의 Hide logs during second render in Strict Mode` : 프로덕션 모드에서는 한 번씩 출력되지만, 엄격 모드에서 실행되는 경우 useEffect 등이 두 번씩 작동하는데 이를 막고 싶다면 해당 버튼을 활성화한다.
    - `Profiler 탭의 Record why each component rendered while profiling` : 프로파일링 도중 컴포넌트가 렌더링된 원인에 대해 기록한다. 애플리케이션 속도가 조금 느려질 수 있지만 디버깅에 도움이 되는 옵션이므로 켜두는 것이 좋다.
- **프로파일링**

# 7장 크롬 개발자 도구를 활용한 애플리케이션 분석

## 7.1 크롬 개발자 도구란?

- 크롬에서 제공하는 개발자용 도구.
- 웹 페이지에서 일어나는 거의 모든 일을 확인할 수 있다.
- 시크릿 모드 또는 프라이빗 모드 불리는 개인정보 보호 모드에서 페이지와 개발자 도구를 여는 것을 권장한다.

## 7.2 요소 탭

- 현재 웹페이지를 구성하고 있는 HTML, CSS등의 정보를 확인할 수 있다.

### 7.2.1 요소 화면

- 클래스나 속성값이 동적으로 제어되는 DOM이 있다면 요소의 중단점을 사용해 디버깅할 수 있다.
- 요소에 속성을 추가, 수정, 삭제하거나 해당 요소를 스크린숏으로 캡처하거나 숨기는 등 HTML DOM과 관련된 다양한 작업을 수행할 수 있다.

### 7.2.2 요소 정보

- 해당 요소와 관련된 모든 정보를 확인할 수 있다.
- DOM에 추가돼 있는 이벤트 리스너, 접근성 등 정보를 확인할 수 있다.

## 7.3 소스 탭

- 개발 모드에서 디버깅하고 싶은 파일을 직접 열어서 중단점을 만들어서 이전에 할당한 변수에는 어떤값이 들어있는지 확인할 수 있다.
- 사용중인 라이브러리에서 버그가 의심되는 지점을 디버깅하거나 실제 소스코드상에서 어떤 식으로 작동하는지 확인하고 싶을 때 매우 유용하다.

## 7.4 네트워크 탭

- 해당 웹페이지를 접속하는 순간부터 발생하는 모든 네트워크 관련 작동이 기록된다.
- HTTP 요청, 웹소켓 등 웹페이지가 외부 데이터와 통신하는 정보를 확인힐 수 있다.
- 네트워크 탭을 통해 집중적으로 확인할 사항
    1. 불필요한 요청 또는 중복되는 요청이 없는지
    2. 웹페이지 구성에 필요한 리소스 크기가 너무 크지않은지
    3. 리소스를 불러오는 속도는 적절한지 또는 너무 속도가 오래 걸리는 리소스는 없는지
    4. 리소스가 올바른 우선순위로 다운로드되어 페이지를 자연스럽게 만들어가는지

## 7.5 메모리 탭

- 현재 웹 페이지가 차지하고 있는 메모리 관련 정보를 확인할 수 있다.
- 애플리케이션에서 발생하는 메모리 누수, 속도 저하, 혹은 웹페이지 프리징 현상을 확인할 수 있는 유용한 도구다.

### 7.5.1 자바스크립트 인스턴스 VM 선택

- 현재 실행중인 자바스크립트 인스턴스를 선택하여 메모리 프로파일링을 시작한다.
- 인스턴스 별 힙 크기 확인 가능

### 7.5.2 힙 스냅샷

- 현재 페이지를 사진 찍듯이 저장해 두고 프로파일링을 한다.
- 스냅샷끼리 비교를 통해 누수를 검출

### 7.5.3 타임라인 할당 계측

- 시간의 흐름에 따라 메모리 변화를 확인하는 기능

### 7.5.4 할당 샘플링

- 할당 계측과 비슷하나 자바스크립트 실행 스택별로 분석할 수 있고, 이 분석을 함수 단위로 한다는 차이점이 있다.

## 7.6 Next.js 환경 디버깅하기

- 서버 사이드 렌더링 환경에서 메모리 누수 탐지

### 7.6.1 Next.js 프로젝트를 디버그 모드로 실행하기

- inspect 옵션을 사용해 프로젝트 실행

### 7.6.2 Next.js 서버에 트래픽 유입시키기

- 서버 사이드 렌더링의 경우 사용자 유입이 늘어나면서 메모리 누수가 발생하는 경우가 많다.
- 서버에 부하를 줘서 메모리 누수를 확인하는 것이 확실한 방법

### 7.6.3 Next.js의 메모리 누수 지점 확인하기

- 메모리 도구로 프로파일링해서 누수 지점을 확인한다.
